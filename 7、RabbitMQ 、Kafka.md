 ### 1、什么是MQ

消息队列，主要作为分布式应用之间实现异步通信的方式

由三部分组成，消息生产者，消息服务端，消息消费者

主要作用，实现服务之间的解耦，多个服务之间业务依赖，削峰

**特性**

​	异步通信

​	系统解耦

​	流量削峰

​	广播通信

**优点**

​	对于数量大或者处理耗时长的操作，我们可以引入MQ实现异步通信，减少客户端的等待

​	提升响应速度，优化客户体验

​	对于改动影响大的系统之间，可以引入MQ实现解耦，减少系统之间的直接以来，提升可维护性	和可扩展性

​	对于出现瞬间的流量峰值的系统，可以引入MQ实现流量削峰，达到保护应用和数据库的目的。

​	一对多的广播通信



### 2、使用MQ带来的一些问题

​	运维成本增加

​	可用性降低，如果MQ服务器宕机，会影响业务

​	系统复杂性增加



### 3、AMQP 协议

​	高级消息队列协议

​	特性：事务支持，持久化支持，可靠性

​	支持的技术：RabbitMQ



### 4、Kafka协议

​	Kafka 协议是基于TCP的二进制协议。消息内部是通过长度来分隔，由一些基本数据类型组成

​	特性：结构简单、解析快、无事务设计、有持久化设计

​	引用：Kafka



### 5、持久化

  RabbitMq，Kafka都支持持久化



### 6、消息分发策略

Rabbit、Kafka 都支持 发布订阅模式，消息拉取模式



### 7、RabbitMQ 可以通过 RabbitMQ CLI  、 HTTP API  实现视图化管理，插件 managment



### 8、交换机类型

​	direct  直连 交换机

​	routingKey 和 bindingKey  消息才会路由到对应的队列



​	topic	主题 交换机

​	bindingKey 可使用通配符



​	Fanout 广播交换机

​	广播类型交换机与队列绑定时，不需要制定绑定建，生产者发送消息到广播类型的交换机上

​	也不需要携带路由键。消息到达交换机时，所有与之绑定了的队列，都会收到相同的消息副本、

### 9、死信队列实现延迟消费

​	

​		Queue 属性  x-message-ttl  指定队列中消息的国企时间，超过这个时间未被消费的消息将被丢弃

​	

​		Message属性  setExpireation， 消息自身的过期时间

​		什么样的数据可以进入死信队列？

​		1、 超时未消费的消息

​		2、消息过期

​		3、队列达到最大长度，会把队列头部的消息移到死信队列中

#####  9.1 死信交换机  DLX 与 死信队列 DLQ

通过定义死信交换机，绑定死信队列。并且绑定非死信队列，那么非死信队列的消息满足上面其3任意条件，会进入到死信队列进行消息



#### 9.2 通过死信队列实现延迟队列

给消息设定延迟时间，不去消费正常队列，让消息在正常队列内过期，然后消费者消费死信队列的消息即可



### 10、生产者发送消息到exchange ，通过confirme机制确实消息是否发送成功



### 11、消费者消费消息通过ACK机制，确认消息是否消费成功

​	这里涉及消费异常处理，

​	手动ACK

​	自动ACk





### 12、消息重复发送，消息重复消费、幂等性问题

​	RabbitMQ不提供幂等性校验，业务侧自己实现数据最终一致性。

​	参考银行每天下班后的对账，保证数据最终 一致性

